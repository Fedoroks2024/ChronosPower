# ChronosPower v2.5 - Руководство по оптимизации памяти

## Обзор

ChronosPower v2.5 был тщательно оптимизирован для обеспечения максимальной функциональности при минимальном использовании памяти. Это руководство объясняет используемые методы оптимизации и способы дальнейшего сокращения использования памяти в ваших проектах.

## Сравнение использования памяти

| Версия | Flash | RAM | Возможности |
|---------|-------|-----|-------------|
| Полная библиотека | 15-25 КБ | 512-1024 байт | Полный набор функций |
| Оптимизированная сборка | 8-15 КБ | 256-512 байт | Выбранные функции |
| Облегченная версия | <2 КБ | <64 байт | Основная функциональность |

## Используемые методы оптимизации

### 1. Условная компиляция

\`\`\`cpp
#ifdef CHRONOS_ENABLE_ADVANCED_FEATURES
// Продвинутые функции компилируются только при необходимости
#endif

#ifdef CHRONOS_PLATFORM_AVR
// AVR-специфичный код только на платформах AVR
#endif
\`\`\`

**Экономия памяти**: 60-80% сокращение неиспользуемого кода

### 2. Шаблонное метапrogrammирование

\`\`\`cpp
template<PowerDomain domain>
static constexpr uint64_t getPeripheralMask();

// Генерирует код только для используемых доменов во время компиляции
\`\`\`

**Экономия памяти**: Абстракции нулевой стоимости, без накладных расходов времени выполнения

### 3. Хранение в PROGMEM

\`\`\`cpp
const char status_ok[] PROGMEM = "OK";
const char* const status_strings[] PROGMEM = { /* ... */ };
\`\`\`

**Экономия памяти**: 2-4 КБ RAM сохранено за счет хранения констант во flash

### 4. Упакованные структуры

\`\`\`cpp
struct __attribute__((packed)) ThermalMetrics {
    int8_t currentTemperatureCelsius;
    uint8_t thermalThrottlingActive : 1;
    uint8_t thermalZone : 3;
    uint8_t thermalThrottlingLevel : 4;
};
\`\`\`

**Экономия памяти**: 40-60% сокращение размеров структур

### 5. Оптимизированные перечисления

\`\`\`cpp
enum class Status : int8_t { /* 8-бит вместо 32-бит */ };
enum class PowerProfile : uint8_t { /* 8-битное перечисление */ };
\`\`\`

**Экономия памяти**: 75% сокращение хранения перечислений

### 6. Ленивая инициализация

\`\`\`cpp
inline ChronosPowerManager& CPower() {
    if (!g_powerManager) {
        static ChronosPowerManager instance;
        g_powerManager = &instance;
    }
    return *g_powerManager;
}
\`\`\`

**Экономия памяти**: Объекты создаются только при необходимости

## Как минимизировать использование памяти

### 1. Выберите правильную версию

#### Для устройств с ограниченной памятью (<8КБ Flash, <512Б RAM):
\`\`\`cpp
#include "ChronosPowerLite.h"
using namespace ChronosPowerLite;
\`\`\`

#### Для устройств со средней памятью:
\`\`\`cpp
#define CHRONOS_ENABLE_BASIC_FEATURES_ONLY
#include "ChronosPower.h"
\`\`\`

#### Для устройств с достаточной памятью:
\`\`\`cpp
#define CHRONOS_ENABLE_ADVANCED_FEATURES
#include "ChronosPower.h"
\`\`\`

### 2. Условная компиляция функций

\`\`\`cpp
// Включайте только нужные функции
#define CHRONOS_ENABLE_QUANTUM_FEATURES
#define CHRONOS_ENABLE_NEURAL_FEATURES
#define CHRONOS_ENABLE_ENERGY_HARVESTING
#define CHRONOS_ENABLE_ADVANCED_LOGGING

#include "ChronosPower.h"
\`\`\`

### 3. Платформо-специфичные сборки

Библиотека автоматически определяет вашу платформу и включает только соответствующий код:

\`\`\`cpp
// Автоматически определяется на основе платформы
#ifdef CHRONOS_PLATFORM_AVR
// Включается только AVR код
#elif defined(CHRONOS_PLATFORM_ESP32)
// Включается только ESP32 код
#endif
\`\`\`

### 4. Оптимизируйте использование

#### Используйте переменные стека вместо кучи:
\`\`\`cpp
// Хорошо - выделение стека
WakeupPolicy policy;
policy.rtcTimeoutSeconds = 300;

// Избегайте - выделение кучи
WakeupPolicy* policy = new WakeupPolicy();
\`\`\`

#### Используйте макросы для простых операций:
\`\`\`cpp
// Более эффективно по памяти
CHRONOS_SLEEP_MS(1000);

// Вместо
CPower().sleep(1000);
\`\`\`

#### Минимизируйте использование callback:
\`\`\`cpp
// Регистрируйте только действительно используемые callback
CPower().registerEnergyCallback(myEnergyCallback);
// Не регистрируйте неиспользуемые callback
\`\`\`

## Использование памяти по функциям

| Функция | Flash (КБ) | RAM (байт) | Описание |
|---------|------------|-------------|-------------|
| Основное управление питанием | 2-3 | 32-64 | Базовые профили, сон, частота |
| Управление периферией | 1-2 | 16-32 | Индивидуальное управление периферией |
| Мониторинг энергии | 1-2 | 24-48 | Метрики и отслеживание энергии |
| Тепловое управление | 0.5-1 | 12-24 | Мониторинг температуры |
| Адаптивное масштабирование | 2-4 | 48-96 | ИИ-оптимизация |
| Квантовые функ
